# =============================================================================
# Conda Environment for macOS Apple Silicon (M1/M2/M3)
# =============================================================================
# Create: conda env create -f environment-macos-arm64.yml
# Update: conda env update -f environment-macos-arm64.yml --prune
# Activate: conda activate voice-translate-arm64
# =============================================================================

name: voice-translate-arm64
channels:
  - conda-forge
  - pytorch
  - defaults

dependencies:
  # Python version
  - python=3.11
  
  # Build tools
  - pip>=23.0
  - setuptools>=68.0
  - wheel>=0.40
  
  # Core scientific stack (ARM64 optimized)
  - numpy>=1.24.0
  - scipy>=1.10.0
  - pandas>=2.0.0
  
  # PyTorch for Apple Silicon (MPS support)
  - pytorch>=2.1.0
  - torchvision>=0.16.0
  - torchaudio>=2.1.0
  
  # Audio processing
  - librosa>=0.10.0
  - soundfile>=0.12.0
  - ffmpeg>=6.0  # Required for audio I/O
  
  # Audio capture - CoreAudio
  - portaudio>=19.0  # For sounddevice
  
  # ML utilities
  - transformers>=4.35.0
  - tokenizers>=0.14.0
  - sentencepiece>=0.1.99
  - protobuf>=4.24.0
  
  # System utilities
  - pyyaml>=6.0
  - requests>=2.28.0
  - tqdm>=4.65.0
  
  # Development
  - pytest>=7.3.0
  - pytest-asyncio>=0.21.0
  - black>=23.0.0
  - flake8>=6.0.0
  - mypy>=1.3.0
  
  # Pip dependencies for packages not in conda
  - pip:
    # Audio capture
    - sounddevice>=0.4.6
    
    # Whisper
    - openai-whisper>=20231117
    
    # Voice Activity Detection
    - silero-vad>=4.0.0
    - webrtcvad>=2.0.10
    - noisereduce>=3.0.0
    
    # CoreML (Apple Silicon only)
    - coremltools>=7.0
    
    # Utilities
    - python-dotenv>=1.0.0
    - click>=8.1.0
    - rich>=13.0.0
    - pydantic>=2.0.0
    - structlog>=23.0.0
    
    # macOS specific
    - pyobjc-framework-Accelerate>=9.0
    - py2app>=0.28  # For macOS app bundling

# =============================================================================
# Post-creation setup commands (run manually after creation):
# =============================================================================
# 1. Install BlackHole for system audio capture:
#    brew install blackhole-2ch
#
# 2. Verify MPS availability:
#    python -c "import torch; print(torch.backends.mps.is_available())"
#
# 3. Test audio:
#    python -c "import sounddevice; print(sounddevice.query_devices())"
# =============================================================================
